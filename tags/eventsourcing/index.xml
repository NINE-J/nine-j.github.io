<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>EventSourcing on B9F1</title><link>https://blog.b9f1.com/tags/eventsourcing/</link><description>Recent content in EventSourcing on B9F1</description><generator>Hugo -- gohugo.io</generator><language>en-us</language><lastBuildDate>Fri, 10 Oct 2025 19:41:23 +0900</lastBuildDate><atom:link href="https://blog.b9f1.com/tags/eventsourcing/index.xml" rel="self" type="application/rss+xml"/><item><title>MSA Outbox íŒ¨í„´</title><link>https://blog.b9f1.com/p/2025-10-10-outbox-patterns-for-data-consistency-and-event-reliability-in-msa/</link><pubDate>Fri, 10 Oct 2025 19:41:23 +0900</pubDate><guid>https://blog.b9f1.com/p/2025-10-10-outbox-patterns-for-data-consistency-and-event-reliability-in-msa/</guid><description>&lt;h2 id="ê°œìš”"&gt;ğŸ“Œê°œìš”
&lt;/h2&gt;&lt;p&gt;MSAì—ì„œ ê° ì„œë¹„ìŠ¤ëŠ” ë…ë¦½ì ì¸ ë°ì´í„°ë² ì´ìŠ¤ì™€ ë©”ì‹œì§€ ë¸Œë¡œì»¤ë¥¼ ì‚¬ìš©í•˜ë©° ì´ë¥¼ í†µí•´ ë¹„ë™ê¸° ì´ë²¤íŠ¸ë¥¼ êµí™˜í•œë‹¤.&lt;/p&gt;
&lt;p&gt;í•˜ì§€ë§Œ ì´ êµ¬ì¡°ëŠ” í•˜ë‚˜ì˜ íŠ¸ëœì­ì…˜ ë‚´ì—ì„œ ë°ì´í„° ì €ì¥ê³¼ ì´ë²¤íŠ¸ ë°œí–‰ì´ ë¶„ë¦¬ë˜ê¸° ë•Œë¬¸ì— ë°ì´í„° ì¼ê´€ì„±ê³¼ ë©”ì‹œì§€ ì‹ ë¢°ì„±ì„ ë³´ì¥í•˜ê¸° ì–´ë µë‹¤.&lt;/p&gt;
&lt;p&gt;ì˜ˆë¥¼ ë“¤ì–´ ê²°ì œ ì„œë¹„ìŠ¤ê°€ ê²°ì œ ì •ë³´ë¥¼ DBì— ì €ì¥í•œ í›„ kafkaì— ê²°ì œ ì™„ë£Œ ì´ë²¤íŠ¸ë¥¼ ë°œí–‰í•œë‹¤ê³  í•˜ì. ë§Œì•½ DB ì €ì¥ì€ ì„±ê³µí–ˆì§€ë§Œ kafka ë°œí–‰ì´ ì‹¤íŒ¨í•œë‹¤ë©´?
ê²°ì œëŠ” ë˜ì—ˆëŠ”ë° ì•Œë¦¼ ì„œë¹„ìŠ¤ë‚˜ ë°°ì†¡ ì„œë¹„ìŠ¤ëŠ” ì´ë¥¼ ëª¨ë¥´ê²Œ ëœë‹¤.&lt;/p&gt;
&lt;p&gt;ì´ëŸ° ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•œ ì•ˆì „í•œ ì „ëµì´ ë°”ë¡œ Outbox íŒ¨í„´ì´ë‹¤.&lt;/p&gt;
&lt;div class="admonition info"&gt;
&lt;div class="admonition-header"&gt;&lt;svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"&gt;&lt;path d="M256 512A256 256 0 1 0 256 0a256 256 0 1 0 0 512zM216 336l24 0 0-64-24 0c-13.3 0-24-10.7-24-24s10.7-24 24-24l48 0c13.3 0 24 10.7 24 24l0 88 8 0c13.3 0 24 10.7 24 24s-10.7 24-24 24l-80 0c-13.3 0-24-10.7-24-24s10.7-24 24-24zm40-208a32 32 0 1 1 0 64 32 32 0 1 1 0-64z"/&gt;&lt;/svg&gt;
&lt;span&gt;Info&lt;/span&gt;
&lt;/div&gt;
&lt;div class="admonition-content"&gt;
&lt;p&gt;OutboxëŠ” ë³´ë‚¼ í¸ì§€í•¨ì´ë¼ëŠ” ëœ»ì´ë©° &lt;code&gt;Transactional Outbox Pattern&lt;/code&gt;ìœ¼ë¡œ ì¡°íšŒí–ˆì„ ë•Œ ë‹¤ì–‘í•œ ì •ë³´ê°€ ìˆì—ˆë‹¤.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h2 id="ë‚´ìš©"&gt;ğŸ“Œë‚´ìš©
&lt;/h2&gt;&lt;h3 id="ë¬¸ì œ-ìƒí™©"&gt;ë¬¸ì œ ìƒí™©
&lt;/h3&gt;&lt;p&gt;MSA í™˜ê²½ì—ì„œ ë‹¤ìŒê³¼ ê°™ì€ ë¶ˆì¼ì¹˜ê°€ ìì£¼ ë°œìƒí•œë‹¤.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;DBì—ëŠ” ë°˜ì˜ë˜ì—ˆì§€ë§Œ ì´ë²¤íŠ¸ ë°œí–‰ ì‹¤íŒ¨&lt;/li&gt;
&lt;li&gt;ì´ë²¤íŠ¸ëŠ” ë°œí–‰ë˜ì—ˆì§€ë§Œ ë°ì´í„° ì €ì¥ ì‹¤íŒ¨&lt;/li&gt;
&lt;li&gt;ì¤‘ë³µ ë°œí–‰ ë° ìˆœì„œ ë¶ˆì¼ì¹˜&lt;/li&gt;
&lt;li&gt;ì„œë¹„ìŠ¤ ê°„ ì¬ì‹œë„ ë¡œì§ìœ¼ë¡œ ì¸í•œ ì¤‘ë³µ ì²˜ë¦¬&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ì´ëŠ” &lt;strong&gt;DB íŠ¸ëœì­ì…˜ê³¼ ë©”ì‹œì§€ ë°œí–‰ì´ ì›ìì (atomic)&lt;/strong&gt; ìœ¼ë¡œ ë¬¶ì—¬ìˆì§€ ì•Šê¸° ë•Œë¬¸ì— ë°œìƒí•œë‹¤.&lt;/p&gt;
&lt;h3 id="ê¸°ì¡´-ì ‘ê·¼ì˜-í•œê³„"&gt;ê¸°ì¡´ ì ‘ê·¼ì˜ í•œê³„
&lt;/h3&gt;&lt;h4 id="2pctwo-phase-commit"&gt;2PC(Two-Phase Commit)
&lt;/h4&gt;&lt;p&gt;DBì™€ ë©”ì‹œì§€ ë¸Œë¡œì»¤ê°€ XA íŠ¸ëœì­ì…˜ì„ ì§€ì›í•´ì•¼ í•˜ë©°, ë½ ê²½í•©ê³¼ ë„¤íŠ¸ì›Œí¬ ì˜¤ë²„í—¤ë“œë¡œ ì¸í•´ í™•ì¥ì„± ì¸¡ë©´ì—ì„œ ë¶€ì í•©í•˜ë‹¤.&lt;/p&gt;
&lt;div class="admonition info"&gt;
&lt;div class="admonition-header"&gt;&lt;svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"&gt;&lt;path d="M256 512A256 256 0 1 0 256 0a256 256 0 1 0 0 512zM216 336l24 0 0-64-24 0c-13.3 0-24-10.7-24-24s10.7-24 24-24l48 0c13.3 0 24 10.7 24 24l0 88 8 0c13.3 0 24 10.7 24 24s-10.7 24-24 24l-80 0c-13.3 0-24-10.7-24-24s10.7-24 24-24zm40-208a32 32 0 1 1 0 64 32 32 0 1 1 0-64z"/&gt;&lt;/svg&gt;
&lt;span&gt;XS íŠ¸ëœì­ì…˜&lt;/span&gt;
&lt;/div&gt;
&lt;div class="admonition-content"&gt;
&lt;p&gt;í‘œì¤€í™”ëœ ë¶„ì‚° íŠ¸ëœì­ì…˜ êµ¬í˜„ XA(eXtended Architecture)ëŠ” 2PC(2 phase commit)ì„ í†µí•œ ë¶„ì‚° íŠ¸ëœì­ì…˜ ì²˜ë¦¬ë¥¼ ìœ„í•´ X-Openì—ì„œ ëª…ì‹œí•œ í‘œì¤€ì´ë‹¤.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h4 id="application-level-retry"&gt;Application-Level Retry
&lt;/h4&gt;&lt;p&gt;ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ë°œí–‰ ì‹¤íŒ¨ ì‹œ ì¬ì‹œë„ë¥¼ êµ¬í˜„í•  ìˆ˜ ìˆì§€ë§Œ ë„¤íŠ¸ì›Œí¬ ì¥ì• ë‚˜ ì¥ì•  ë³µêµ¬ ì‹œì ì— ë”°ë¼ &lt;strong&gt;ì¤‘ë³µ ì´ë²¤íŠ¸&lt;/strong&gt; ë˜ëŠ” &lt;strong&gt;ìˆœì„œ ì—­ì „&lt;/strong&gt;ì´ ë°œìƒí•  ìˆ˜ ìˆë‹¤.&lt;/p&gt;
&lt;h3 id="outbox-íŒ¨í„´ìœ¼ë¡œ-í•´ê²°í• -ìˆ˜-ìˆëŠ”-ê²ƒ"&gt;Outbox íŒ¨í„´ìœ¼ë¡œ í•´ê²°í•  ìˆ˜ ìˆëŠ” ê²ƒ
&lt;/h3&gt;&lt;p&gt;Outbox íŒ¨í„´ì€ &lt;strong&gt;ë¹„ì¦ˆë‹ˆìŠ¤ ë°ì´í„°ì™€ ì´ë²¤íŠ¸ë¥¼ ë™ì¼ íŠ¸ëœì­ì…˜ ë‚´ì—ì„œ ì²˜ë¦¬í•˜ê³ &lt;/strong&gt; ì´í›„ ë³„ë„ì˜ &lt;strong&gt;Message Relay í”„ë¡œì„¸ìŠ¤&lt;/strong&gt;ê°€ ë©”ì‹œì§€ ë¸Œë¡œì»¤(Kafka, RabbitMQ ë“±)ì— ë°œí–‰í•˜ëŠ” êµ¬ì¡°ë‹¤.&lt;/p&gt;
&lt;p&gt;ì´ ë°©ì‹ì€ íŠ¸ëœì­ì…˜ ì¼ê´€ì„±ê³¼ ë©”ì‹œì§€ ì‹ ë¢°ì„±ì„ ëª¨ë‘ í™•ë³´í•œë‹¤.&lt;/p&gt;
&lt;h4 id="ì²˜ë¦¬-íë¦„-ìš”ì•½"&gt;ì²˜ë¦¬ íë¦„ ìš”ì•½
&lt;/h4&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;ë¹„ì¦ˆë‹ˆìŠ¤ íŠ¸ëœì­ì…˜ ìˆ˜í–‰&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;ORDER&lt;/code&gt; í…Œì´ë¸”ì— INSERT / UPDATE / DELETE ìˆ˜í–‰&lt;/li&gt;
&lt;li&gt;ê°™ì€ íŠ¸ëœì­ì…˜ ë‚´ì—ì„œ &lt;code&gt;OUTBOX&lt;/code&gt; í…Œì´ë¸”ì— ì´ë²¤íŠ¸ ë©”ì‹œì§€(í˜ì´ë¡œë“œ) ì €ì¥&lt;/li&gt;
&lt;li&gt;ë‘ í…Œì´ë¸”ì€ &lt;strong&gt;í•˜ë‚˜ì˜ íŠ¸ëœì­ì…˜ ë‹¨ìœ„&lt;/strong&gt;ë¡œ ì»¤ë°‹ë¨, ì›ìì„±(Atomicity) í™•ë³´&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ë©”ì‹œì§€ ë¦´ë ˆì´(Message Relay)&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;íŠ¸ëœì­ì…˜ì´ ì»¤ë°‹ëœ í›„, ë³„ë„ í”„ë¡œì„¸ìŠ¤ê°€ &lt;code&gt;OUTBOX&lt;/code&gt; í…Œì´ë¸”ì„ ì£¼ê¸°ì ìœ¼ë¡œ ì½ìŒ&lt;/li&gt;
&lt;li&gt;ë°œí–‰ë˜ì§€ ì•Šì€ ì´ë²¤íŠ¸(&lt;code&gt;status = NEW&lt;/code&gt;)ë¥¼ ì°¾ì•„ ë©”ì‹œì§€ ë¸Œë¡œì»¤ì— Publish&lt;/li&gt;
&lt;li&gt;ë°œí–‰ ì„±ê³µ ì‹œ &lt;code&gt;status = PUBLISHED&lt;/code&gt;ë¡œ ê°±ì‹ &lt;/li&gt;
&lt;li&gt;ì‹¤íŒ¨ ì‹œ ì¬ì‹œë„ ë¡œì§ ë˜ëŠ” DLQ(Dead Letter Queue)ë¡œ ì´ë™&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ë©”ì‹œì§€ ë¸Œë¡œì»¤&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;Kafka, RabbitMQ, AWS SNS/SQS ë“±ìœ¼ë¡œ ë©”ì‹œì§€ ì „ë‹¬&lt;/li&gt;
&lt;li&gt;êµ¬ë… ì„œë¹„ìŠ¤ë“¤ì´ í•´ë‹¹ ì´ë²¤íŠ¸ë¥¼ ë¹„ë™ê¸°ì ìœ¼ë¡œ ì²˜ë¦¬&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;div class="mermaid-container zoomable"&gt;
&lt;pre class="mermaid"&gt;
flowchart LR
A[Order Service] --&gt;|INSERT/UPDATE/DELETE| B[(ORDER table)]
A --&gt;|INSERT event| C[(OUTBOX table)]
subgraph Database
B
C
end
C --&gt;|Read Outbox| D[Message Relay]
D --&gt;|Publish Event| E[Message Broker]
classDef highlight fill:#f4f4f4,stroke:#666,stroke-width:1px;
class B,C highlight
&lt;/pre&gt;
&lt;/div&gt;
&lt;h4 id="êµ¬ì„±-ìš”ì†Œ"&gt;êµ¬ì„± ìš”ì†Œ
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Sender (Order Service):&lt;/strong&gt; ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ìˆ˜í–‰ ë° Outboxì— ì´ë²¤íŠ¸ ê¸°ë¡&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Database:&lt;/strong&gt; ë¹„ì¦ˆë‹ˆìŠ¤ ë°ì´í„°(&lt;code&gt;ORDER&lt;/code&gt;)ì™€ ì´ë²¤íŠ¸ ë¡œê·¸(&lt;code&gt;OUTBOX&lt;/code&gt;)ë¥¼ í•¨ê»˜ ì €ì¥&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Message Outbox:&lt;/strong&gt; ë°œí–‰ ëŒ€ê¸° ì¤‘ì¸ ì´ë²¤íŠ¸ë¥¼ ì €ì¥í•˜ëŠ” í…Œì´ë¸” ë˜ëŠ” ì»¬ë ‰ì…˜&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Message Relay:&lt;/strong&gt; Outbox í…Œì´ë¸”ì—ì„œ ì´ë²¤íŠ¸ë¥¼ ì½ì–´ ë©”ì‹œì§€ ë¸Œë¡œì»¤ë¡œ ë°œí–‰&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Message Broker:&lt;/strong&gt; ì´ë²¤íŠ¸ë¥¼ ë‹¤ë¥¸ ì„œë¹„ìŠ¤ì— ì „ë‹¬ (Kafka, RabbitMQ ë“±)&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="ì£¼ìš”-ì¥ì "&gt;ì£¼ìš” ì¥ì 
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;í•­ëª©&lt;/th&gt;
&lt;th&gt;ì„¤ëª…&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;íŠ¸ëœì­ì…˜ ì¼ê´€ì„± ë³´ì¥&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;DB ì €ì¥ê³¼ ì´ë²¤íŠ¸ ê¸°ë¡ì´ í•˜ë‚˜ì˜ íŠ¸ëœì­ì…˜ìœ¼ë¡œ ì²˜ë¦¬ë¨&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ì¬ì²˜ë¦¬ ê°€ëŠ¥&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Outbox í…Œì´ë¸”ì„ ê¸°ì¤€ìœ¼ë¡œ ì‹¤íŒ¨í•œ ì´ë²¤íŠ¸ë¥¼ ì¬ì „ì†¡ ê°€ëŠ¥&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ë©±ë“±ì„±(idempotency)&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ì´ë²¤íŠ¸ ë°œí–‰ ì‹œ &lt;code&gt;event_id&lt;/code&gt;ë¡œ ì¤‘ë³µ ì²˜ë¦¬ ë°©ì§€&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;í™•ì¥ì„±&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Kafka Connect / Debezium ë“±ì„ í†µí•´ Change Data Capture(CDC) ê¸°ë°˜ìœ¼ë¡œ í™•ì¥ ê°€ëŠ¥&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id="outbox--cdcchange-data-capture"&gt;Outbox + CDC(Change Data Capture)
&lt;/h3&gt;&lt;p&gt;ë‹¨ìˆœ í´ë§ ê¸°ë°˜ì€ ë¶€í•˜ê°€ í¬ê¸° ë•Œë¬¸ì— &lt;strong&gt;Debezium + Kafka Connect&lt;/strong&gt; ì¡°í•©ì„ ì‚¬ìš©í•˜ê¸°ë„ í•œë‹¤.
DB íŠ¸ëœì­ì…˜ ë¡œê·¸ë¥¼ êµ¬ë…í•˜ì—¬ outbox í…Œì´ë¸”ì˜ ë³€ê²½ ì‚¬í•­ë§Œ ìº¡ì²˜í•´ ì´ë²¤íŠ¸ë¥¼ ë°œí–‰í•˜ë¯€ë¡œ íš¨ìœ¨ì ì´ë‹¤.&lt;/p&gt;
&lt;h3 id="ìœ ì‚¬-íŒ¨í„´ê³¼-ë¹„êµ"&gt;ìœ ì‚¬ íŒ¨í„´ê³¼ ë¹„êµ
&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;íŒ¨í„´&lt;/th&gt;
&lt;th&gt;ì„¤ëª…&lt;/th&gt;
&lt;th&gt;í•œê³„&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Saga íŒ¨í„´&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ì—¬ëŸ¬ ì„œë¹„ìŠ¤ íŠ¸ëœì­ì…˜ì„ ë³´ìƒ íŠ¸ëœì­ì…˜ìœ¼ë¡œ ê´€ë¦¬&lt;/td&gt;
&lt;td&gt;ë³µì¡í•œ ë³´ìƒ ë¡œì§, ìˆœì°¨ì  ì§€ì—°&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Event Sourcing&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ìƒíƒœë¥¼ ì´ë²¤íŠ¸ ìŠ¤íŠ¸ë¦¼ìœ¼ë¡œ ì €ì¥&lt;/td&gt;
&lt;td&gt;ì´ë²¤íŠ¸ ì¬ìƒ ë¹„ìš©, ë³µì¡í•œ ì¿¼ë¦¬&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Outbox íŒ¨í„´&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ì´ë²¤íŠ¸ë¥¼ ë³„ë„ í…Œì´ë¸”ì— ê¸°ë¡ í›„ ë°œí–‰&lt;/td&gt;
&lt;td&gt;Outbox í…Œì´ë¸” ê´€ë¦¬ í•„ìš”&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id="ì ìš©-ì‹œ-ê³ ë ¤ì‚¬í•­"&gt;ì ìš© ì‹œ ê³ ë ¤ì‚¬í•­
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;Outbox í…Œì´ë¸”ì€ ì£¼ê¸°ì ìœ¼ë¡œ ì •ë¦¬(cleanup) í•„ìš”&lt;/li&gt;
&lt;li&gt;ì´ë²¤íŠ¸ ë°œí–‰ ì‹¤íŒ¨ ì‹œ ì¬ì‹œë„ ì •ì±… ë° DLQ(Dead Letter Queue) êµ¬ì„±&lt;/li&gt;
&lt;li&gt;ë°œí–‰ ìˆœì„œ ë³´ì¥ì„ ìœ„í•œ íŒŒí‹°ì…”ë‹ í‚¤ ì„¤ê³„ (&lt;code&gt;aggregate_id&lt;/code&gt; ê¸°ë°˜)&lt;/li&gt;
&lt;li&gt;Kafka ë“± ë©”ì‹œì§€ ë¸Œë¡œì»¤ì˜ ì „ë‹¬ ë³´ì¦ ì„¤ì • (&lt;code&gt;at-least-once&lt;/code&gt; vs &lt;code&gt;exactly-once&lt;/code&gt;)&lt;/li&gt;
&lt;li&gt;ë°œí–‰ ì¤‘ë³µ ëŒ€ë¹„ë¥¼ ìœ„í•œ ë©±ë“± ì²˜ë¦¬ ì „ëµ (&lt;code&gt;unique event_id&lt;/code&gt;)&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="outbox-íŒ¨í„´-ì ìš©-ê´€ë ¨-íŠ¸ëŸ¬ë¸”ìŠˆíŒ…"&gt;Outbox íŒ¨í„´ ì ìš© ê´€ë ¨ íŠ¸ëŸ¬ë¸”ìŠˆíŒ…
&lt;/h3&gt;&lt;p&gt;ë‚ ì”¨ ì •ë³´ë¡œ ì‚¬ìš©ìì˜ OOTDë¥¼ ì¶”ì²œí•˜ëŠ” ì„œë¹„ìŠ¤(í”¼ë“œ ê³µìœ , DM ë“± SNS ê¸°ëŠ¥ í¬í•¨)
ë‚ ì”¨ ë„ë©”ì¸ì„ ë‹´ë‹¹í•˜ëŠ” íŒ€ì›ì˜ PRì„ ë¦¬ë·°í•˜ë‹¤ê°€ íŠ¹ì´í•œ ìƒí™©ì„ ë§Œë‚¬ë‹¤.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ë°°ì¹˜ ì¡ì„ ì‹¤í–‰í•˜ë©° íŠ¹ë³„í•œ ë‚ ì”¨ ë³€í™”ê°€ ê°ì§€ë˜ë©´ ì•Œë¦¼ì„ ìƒì„±í•˜ëŠ” ì¼€ì´ìŠ¤&lt;/li&gt;
&lt;li&gt;í•´ë‹¹ í…ŒìŠ¤íŠ¸ëŠ” ë‹¤ë¥¸ í…ŒìŠ¤íŠ¸ì˜ DBì™€ ì¶©ëŒì´ ì—†ë„ë¡ ë…ë¦½ëœ ì¸ë©”ëª¨ë¦¬ DBë¡œ ì‹¤í–‰.&lt;/li&gt;
&lt;li&gt;ë¡œì»¬ í…ŒìŠ¤íŠ¸ ì½”ë“œì—ì„œ ì‹¤í–‰ ì‹œ ì„±ê³µ ë˜ëŠ” ë¬´í•œ ë£¨í”„ë¡œ ì¸í•œ ì‹¤íŒ¨. ì„±ê³µ ë³´ì¥ì´ ì•ˆ ë¨.&lt;/li&gt;
&lt;li&gt;íŠ¹ì´í•˜ê²Œ CI ì´ë ¥ì—” ì„±ê³µ ì¼€ì´ìŠ¤ë§Œ ìˆìŒ.&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id="ë¡œì§-ì ê²€"&gt;ë¡œì§ ì ê²€
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;code&gt;outboxes&lt;/code&gt;ê°€ ë¹„ì—ˆì„ ë•Œë§Œ &lt;code&gt;FINISHED&lt;/code&gt;, ê¸°ë³¸ì€ &lt;code&gt;CONTINUABLE&lt;/code&gt;
&lt;ul&gt;
&lt;li&gt;ëª¨ë“  ì´ë²¤íŠ¸ë¥¼ ë°œì†¡í•˜ê¸° ìœ„í•¨&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;ìˆ˜ì‹  ëŒ€ìƒì´ ì—†ì–´ë„ &lt;code&gt;SENDING&lt;/code&gt; ìƒíƒœë¡œ ì €ì¥í•˜ëŠ” ê²°í•¨ ë°œê²¬
&lt;ul&gt;
&lt;li&gt;ìˆ˜ì‹  ëŒ€ìƒì´ ì—†ì–´ì„œ &lt;code&gt;outbox&lt;/code&gt;ê°€ ì²˜ë¦¬ë˜ì§€ ì•Šê³  ê³„ì† ë‚¨ì•„ìˆìœ¼ë©° &lt;code&gt;CONTINUABLE&lt;/code&gt; ë¬´í•œ ë£¨í”„&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;í•˜ì§€ë§Œ ê°„í—ì ì¸ ì„±ê³µê³¼ CIì—ì„œë§Œ ì„±ê³µí•˜ëŠ” ê±´ ì„¤ëª…ë˜ì§€ ì•ŠìŒ.&lt;/p&gt;
&lt;h4 id="ì„±ê³µ-ì¡°ê±´ê³¼-ì‹¤íŒ¨-ì¡°ê±´-ì ê²€"&gt;ì„±ê³µ ì¡°ê±´ê³¼ ì‹¤íŒ¨ ì¡°ê±´ ì ê²€
&lt;/h4&gt;&lt;blockquote&gt;
&lt;p&gt;ì™œ ë¡œì»¬ì—ì„  ë¬´í•œ ë£¨í”„ë¡œ ì‹¤íŒ¨í•˜ëŠ” ì¼€ì´ìŠ¤ê°€ ìˆê³  CIì—ì„  ì •ìƒ ë™ì‘í•˜ì§€?&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ul&gt;
&lt;li&gt;ì„±ê³µì˜ ì¡°ê±´
&lt;ul&gt;
&lt;li&gt;ë°°ì¹˜ ì‹¤í–‰ ì‹œì ì— &lt;code&gt;PENDING&lt;/code&gt; &lt;code&gt;outbox&lt;/code&gt;ê°€ ë¹„ì–´ìˆë‹¤.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;ì‹¤íŒ¨ì˜ ì¡°ê±´
&lt;ul&gt;
&lt;li&gt;ë°°ì¹˜ ì‹œì‘ í›„, &lt;code&gt;PENDING&lt;/code&gt; &lt;code&gt;outbox&lt;/code&gt; ì¡°íšŒ ì¿¼ë¦¬ì™€ ìˆ˜ì‹  ëŒ€ìƒ ì¡°íšŒ ì¿¼ë¦¬ê°€ ë°˜ë³µ&lt;/li&gt;
&lt;li&gt;ìˆ˜ì‹  ëŒ€ìƒì´ 0ëª…ì¸ ê²½ìš°: &lt;code&gt;SENDING&lt;/code&gt;ìœ¼ë¡œ ë°”ê¾¸ì§€ ì•ŠìŒ, ì—¬ì „íˆ &lt;code&gt;PENDING&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Stepì´ ì¢…ë£Œë˜ì§€ ì•Šê³  ê°™ì€ ì¿¼ë¦¬ë¥¼ ê³„ì† ë‚´ë©° ë¬´í•œ ë°˜ë³µ&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ì§ˆë¬¸ì´ ì˜ëª»ëë‹¤..! ë¡œì»¬ê³¼ CIë¡œ êµ¬ë¶„í•´ì„œ ë³¼ ê²Œ ì•„ë‹ˆë¼ ë¡œì§ ì ê²€ì—ì„œ í™•ì¸í–ˆë˜ &lt;code&gt;outbox&lt;/code&gt;ì˜ ìƒì„± ì—¬ë¶€ë¥¼ ë´¤ì–´ì•¼ í–ˆë‹¤. &amp;ldquo;outboxesê°€ ë¹„ì—ˆì„ ë•Œë§Œ &lt;code&gt;FINISHED&lt;/code&gt;&amp;rdquo; ì˜€ìœ¼ë‹ˆê¹Œ..&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ì¦‰, íŠ¹ë³„í•œ ë‚ ì”¨ ë³€í™”ê°€ ìˆëŠ”ê°€? ì˜€ë‹¤.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ë‚ ì”¨ ì¡°íšŒì— ëŒ€í•œ ê²ƒë„ Mocking í•˜ê±°ë‚˜ ìˆ˜ì‹  ëŒ€ìƒì„ ë³´ì¥í•˜ëŠ” ë“± ë‹¤ì–‘í•œ ë°©ë²•ì´ ìˆì—ˆì„í…ë° ì •ë‹µì´ ì—†ë‹¤ ë³´ë‹ˆ ë°œìƒí–ˆë˜ ë¬¸ì œ ê°™ë‹¤.&lt;/p&gt;
&lt;p&gt;íŠ¹ì´í•˜ê²Œ CIì— ì„±ê³µ ì´ë ¥ë§Œ ìˆë˜ ê²ƒë„ ë§ˆì¹¨ ê·¸ë•ŒëŠ” íŠ¹ë³„í•œ ë‚ ì”¨ ë³€í™”ê°€ ì—†ë˜ ê²ƒ&amp;hellip;&lt;/p&gt;
&lt;h2 id="ê²°ë¡ "&gt;ğŸ¯ê²°ë¡ 
&lt;/h2&gt;&lt;p&gt;Outbox íŒ¨í„´ì€ &lt;strong&gt;MSA í™˜ê²½ì—ì„œ ë°ì´í„° ì¼ê´€ì„±ê³¼ ì´ë²¤íŠ¸ ì‹ ë¢°ì„±ì„ í™•ë³´í•˜ëŠ” í˜„ì‹¤ì ì¸ ëŒ€ì•ˆ&lt;/strong&gt;ì´ ë  ìˆ˜ ìˆë‹¤.&lt;/p&gt;
&lt;h2 id="endnote"&gt;âš™ï¸EndNote
&lt;/h2&gt;&lt;h3 id="ì‚¬ì „-ì§€ì‹"&gt;ì‚¬ì „ ì§€ì‹
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;íŠ¸ëœì­ì…˜ ACID ì†ì„±&lt;/li&gt;
&lt;li&gt;ë©”ì‹œì§€ ë¸Œë¡œì»¤ì˜ ì „ë‹¬ ë³´ì¦ (&lt;code&gt;at-least-once&lt;/code&gt;, &lt;code&gt;exactly-once&lt;/code&gt;)&lt;/li&gt;
&lt;li&gt;Saga, 2PC, Event Sourcing íŒ¨í„´&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="ë”-ì•Œì•„ë³´ê¸°"&gt;ë” ì•Œì•„ë³´ê¸°
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;a class="link" href="https://ssonzm.tistory.com/148" target="_blank" rel="noopener"
&gt;ë¶„ì‚° íŠ¸ëœì­ì…˜ê³¼ XA íŠ¸ëœì­ì…˜ì— ëŒ€í•´&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="link" href="https://devocean.sk.com/blog/techBoardDetail.do?ID=165445&amp;amp;boardType=techBlog" target="_blank" rel="noopener"
&gt;[MSA íŒ¨í„´] SAGA, Transactional Outbox íŒ¨í„´ í™œìš©í•˜ê¸°&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="link" href="https://microservices.io/patterns/data/transactional-outbox.html#:~:text=The%20solution%20is%20for%20the,messages%20to%20the%20message%20broker" target="_blank" rel="noopener"
&gt;Pattern: Transactional outbox&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="ì¶”ê°€-ì •ë¦¬"&gt;ì¶”ê°€ ì •ë¦¬
&lt;/h3&gt;&lt;h4 id="ë‹¨ì¼-ì¸ìŠ¤í„´ìŠ¤monolithic-í™˜ê²½"&gt;ë‹¨ì¼ ì¸ìŠ¤í„´ìŠ¤(Monolithic) í™˜ê²½
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;í•˜ë‚˜ì˜ DB, í•˜ë‚˜ì˜ íŠ¸ëœì­ì…˜ì—ì„œ ëª¨ë“  ë¡œì§ì´ ì²˜ë¦¬ëœë‹¤.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;2PC(2-Phase Commit)&lt;/strong&gt; ê°™ì€ í‘œì¤€ íŠ¸ëœì­ì…˜ ë©”ì»¤ë‹ˆì¦˜ìœ¼ë¡œ DB ì €ì¥ê³¼ ì´ë²¤íŠ¸ ì²˜ë¦¬(ì˜ˆ: ë©”ì‹œì§€ í ë°œí–‰)ë¥¼ í•˜ë‚˜ì˜ ë…¼ë¦¬ì  ë‹¨ìœ„ë¡œ ë¬¶ì„ ìˆ˜ ìˆë‹¤.&lt;/li&gt;
&lt;li&gt;ë”°ë¼ì„œ &lt;strong&gt;ì›ìì„±(Atomicity)&lt;/strong&gt; ê³¼ &lt;strong&gt;ì¼ê´€ì„±(Consistency)&lt;/strong&gt; ì´ ë³´ì¥ëœë‹¤.&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="í™•ì¥-ì‹œ-í•œê³„-ë½-ê²½ìŸ--ì²˜ë¦¬-ë³‘ëª©"&gt;í™•ì¥ ì‹œ í•œê³„ (ë½ ê²½ìŸ &amp;amp; ì²˜ë¦¬ ë³‘ëª©)
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;íŠ¸ë˜í”½ ì¦ê°€ â†’ DB Connection Pool ê²½ìŸ â†’ ë½ ê²½í•©(lock contention) ì¦ê°€&lt;/li&gt;
&lt;li&gt;ëŒ€ê·œëª¨ íŠ¸ëœì­ì…˜ìœ¼ë¡œ ì¸í•´ ì‘ë‹µ ì§€ì—° ë°œìƒ&lt;/li&gt;
&lt;li&gt;DBê°€ &lt;strong&gt;íŠ¸ëœì­ì…˜ ì½”ë””ë„¤ì´í„°&lt;/strong&gt; ì—­í• ê¹Œì§€ í•˜ë¯€ë¡œ ë³‘ëª©ì´ ì‹¬í™”ëœë‹¤.&lt;/li&gt;
&lt;li&gt;ì´ ì‹œì ì—ì„œ &lt;strong&gt;ë‹¨ì¼ DB íŠ¸ëœì­ì…˜ êµ¬ì¡°ëŠ” í™•ì¥ì„±ì˜ í•œê³„&lt;/strong&gt;ì— ë¶€ë”ªíŒë‹¤.&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="ë¶„ì‚°-í™˜ê²½-msa-ë„ì…"&gt;ë¶„ì‚° í™˜ê²½(= MSA ë„ì…)
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;ê° ì„œë¹„ìŠ¤ê°€ &lt;strong&gt;ë…ë¦½ëœ DB&lt;/strong&gt;ë¥¼ ê°€ì§€ê²Œ ë˜ê³  ì„œë¹„ìŠ¤ ê°„ì—ëŠ” &lt;strong&gt;ë¹„ë™ê¸° ë©”ì‹œì§€ í(Kafka, RabbitMQ, SNS/SQS)&lt;/strong&gt; ë¡œ ì´ë²¤íŠ¸ë¥¼ ì „ë‹¬í•œë‹¤.&lt;/li&gt;
&lt;li&gt;ì´ë¡œ ì¸í•´ ì²˜ë¦¬ ì†ë„ëŠ” ë¹„ì•½ì ìœ¼ë¡œ í–¥ìƒëœë‹¤. (ì£¼ìš” ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ë§Œ ë¹ ë¥´ê²Œ ì»¤ë°‹, ë‚˜ë¨¸ì§€ëŠ” ë¹„ë™ê¸°ë¡œ í›„ì²˜ë¦¬)&lt;/li&gt;
&lt;li&gt;í•˜ì§€ë§Œ &lt;strong&gt;ë°ì´í„° ì¼ê´€ì„± ë¬¸ì œ&lt;/strong&gt;ê°€ ìƒˆë¡­ê²Œ ë“±ì¥í•œë‹¤.&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="ìƒˆë¡œìš´-ë¬¸ì œ-ì›ìì„±-ë¶•ê´´"&gt;ìƒˆë¡œìš´ ë¬¸ì œ: ì›ìì„± ë¶•ê´´
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;ë¹„ì¦ˆë‹ˆìŠ¤ íŠ¸ëœì­ì…˜(DB ì»¤ë°‹)ê³¼ ì´ë²¤íŠ¸ ë°œí–‰(Message Send)ì´ &lt;strong&gt;ì„œë¡œ ë‹¤ë¥¸ ì‹œìŠ¤í…œ&lt;/strong&gt;ì—ì„œ ë°œìƒ&lt;/li&gt;
&lt;li&gt;ë‘ ì‘ì—… ì¤‘ í•˜ë‚˜ë¼ë„ ì‹¤íŒ¨í•˜ë©´ ë°ì´í„° ë¶ˆì¼ì¹˜ ë°œìƒ&lt;/li&gt;
&lt;li&gt;ë©”ì‹œì§€ ìˆœì„œê°€ ë°”ë€Œê±°ë‚˜ ì¤‘ë³µ ì´ë²¤íŠ¸ê°€ ë°œìƒí•  ìˆ˜ë„ ìˆìŒ&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="outbox-íŒ¨í„´ì˜-í•´ê²°-ë°©ì‹"&gt;Outbox íŒ¨í„´ì˜ í•´ê²° ë°©ì‹
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;ì„œë¹„ìŠ¤ ë¡œì§ íŠ¸ëœì­ì…˜ ì•ˆì—ì„œ &lt;strong&gt;ë¹„ì¦ˆë‹ˆìŠ¤ ë°ì´í„° + ì´ë²¤íŠ¸ ë¡œê·¸(Outbox)ë¥¼ í•¨ê»˜ ì»¤ë°‹&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;ì´ë¡œì¨ â€œì´ë²¤íŠ¸ ê¸°ë¡â€ê¹Œì§€ëŠ” &lt;strong&gt;ì›ìì„± ë³´ì¥&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;ì´í›„ ë³„ë„ í”„ë¡œì„¸ìŠ¤(Message Relay)ê°€ Outbox í…Œì´ë¸”ì„ ì½ì–´ ë©”ì‹œì§€ ë¸Œë¡œì»¤(Kafka ë“±)ì— ë°œí–‰&lt;/li&gt;
&lt;li&gt;ë°œí–‰ì´ ì„±ê³µí•˜ë©´ ìƒíƒœë¥¼ &lt;code&gt;PUBLISHED&lt;/code&gt;ë¡œ ë³€ê²½ ì‹¤íŒ¨í•˜ë©´ ì¬ì‹œë„ ë˜ëŠ” DLQ(Dead Letter Queue)ë¡œ ì²˜ë¦¬&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="mermaid-container zoomable"&gt;
&lt;pre class="mermaid"&gt;
sequenceDiagram
autonumber
participant Service as Order Service
participant DB as Database
participant Relay as Message Relay
participant Kafka as Kafka Broker
rect rgb(240, 248, 255)
Note over Service,DB: [ì„œë¹„ìŠ¤ íŠ¸ëœì­ì…˜ - ë™ê¸° ì²˜ë¦¬]
Service-&gt;&gt;DB: INSERT INTO orders (...)
Service-&gt;&gt;DB: INSERT INTO outbox_event (...)
DB--&gt;&gt;Service: COMMIT (ë‹¨ì¼ íŠ¸ëœì­ì…˜ìœ¼ë¡œ ì›ìì„± í™•ë³´)
end
rect rgb(250, 250, 250)
Note over Relay,Kafka: [ë¹„ë™ê¸° ë©”ì‹œì§€ ë¦´ë ˆì´ - Outbox Poller]
Relay-&gt;&gt;DB: SELECT * FROM outbox_event WHERE status = 'NEW'
Relay-&gt;&gt;Kafka: Publish Event to Kafka
Kafka--&gt;&gt;Relay: ACK
Relay-&gt;&gt;DB: UPDATE outbox_event SET status = 'PUBLISHED'
end
&lt;/pre&gt;
&lt;/div&gt;
&lt;h4 id="ê²°ê³¼ì ìœ¼ë¡œ"&gt;ê²°ê³¼ì ìœ¼ë¡œ
&lt;/h4&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;êµ¬ë¶„&lt;/th&gt;
&lt;th&gt;ê¸°ì¡´ êµ¬ì¡°&lt;/th&gt;
&lt;th&gt;Outbox ì ìš© í›„&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ì›ìì„±&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;DB â†” MQ ë¶„ë¦¬ë˜ì–´ ê¹¨ì§&lt;/td&gt;
&lt;td&gt;ë™ì¼ íŠ¸ëœì­ì…˜ ë‚´ Outbox ê¸°ë¡ìœ¼ë¡œ ë³´ì¥&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;í™•ì¥ì„±&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ë‹¨ì¼ DB ë½ ë³‘ëª©&lt;/td&gt;
&lt;td&gt;ë¶„ì‚° í™˜ê²½ + ë¹„ë™ê¸° ì²˜ë¦¬ë¡œ ê°œì„ &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ì‹ ë¢°ì„±&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ë°œí–‰ ì‹¤íŒ¨ ì‹œ ìœ ì‹¤ ê°€ëŠ¥&lt;/td&gt;
&lt;td&gt;Outbox ì¬ì‹œë„ / CDCë¡œ íšŒë³µ ê°€ëŠ¥&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;ìš´ì˜ ë³µì¡ë„&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;ë‹¨ìˆœ&lt;/td&gt;
&lt;td&gt;Outbox í…Œì´ë¸” ê´€ë¦¬ í•„ìš”(ìš´ì˜ë¹„ ì¦ê°€)&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;</description></item></channel></rss>